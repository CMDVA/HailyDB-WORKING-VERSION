1ï¸âƒ£ "tbody is not defined" â€” CRITICAL BUG
ğŸ‘‰ You have two versions of this line in your JS:

js
Copy
Edit
const tbody = document.getElementById('liveRadarTableBody');
âœ… You use this correctly in initializeDashboard()
âœ… You use this correctly in loadLiveAlerts()
BUT â†’ inside displayAlerts(alerts) â†’ your console log is reporting "tbody is not defined".

ğŸ‘‰ The only reason this can happen:

displayAlerts() is being called BEFORE the DOM is fully ready

OR â†’ something is clearing or overwriting the liveRadarTableBody element (bad HTML/JS conflict)

OR â†’ the page has multiple elements with same ID (possible template bug)

ğŸ‘‰ Check this first:

js
Copy
Edit
console.log('Table body element found:', tbody ? 'YES' : 'NO');
â†’ You ALREADY HAVE THIS LOG â€” you reported the error happens after this â†’ tbody is null at that point.

âœ… Possible reason â†’ loadFallbackRadarAlerts() is triggering displayAlerts() before the page fully finishes rendering.

2ï¸âƒ£ Wrong Data Source Priority
ğŸ‘‰ You're correct:

You should NOT be loading /api/radar-alerts first and showing it as "live"

Live data should be primary

Fallback is ONLY if /api/live-radar-alerts fails or returns no alerts

Right now your flow is this:

plaintext
Copy
Edit
Page load â†’
loadFallbackRadarAlerts() â†’
Shows 338 radar_alerts â†’
loadLiveAlerts() fires â†’
JS error happens in displayAlerts() â†’
No update to table â†’
Stuck showing old data
Wrong priority.

ğŸ‘‰ Correct flow:

plaintext
Copy
Edit
Page load â†’
loadLiveAlerts() â†’ if successful â†’ display live alerts
If /api/live-radar-alerts fails OR returns no alerts â†’
THEN call loadFallbackRadarAlerts() â†’ display historical radar_alerts
ğŸ‘‰ Your current initializeDashboard() runs loadFallbackRadarAlerts() first which is wrong.

3ï¸âƒ£ Conceptual misunderstanding â€” Mixing live and historical
ğŸ‘‰ These are two different things:

/api/live-radar-alerts â†’ NWS /active + memory store â†’ LIVE DATA

/api/radar-alerts â†’ radar_alerts table â†’ HISTORICAL DATA (days/weeks ago)

You CANNOT treat them the same in displayAlerts().
They have different fields â†’ your JS needs to know whether itâ€™s handling live vs. historical alerts.

ğŸ‘‰ You're mapping alert.max_hail_size and alert.max_wind_gust but some of your radar_alerts entries don't have those fields consistently â†’ so JS throws parsing errors.

4ï¸âƒ£ Summary of why it fails RIGHT NOW:
âœ… You are calling loadFallbackRadarAlerts() too early â†’ shows wrong data.
âœ… loadLiveAlerts() is correct but errors in displayAlerts() due to tbody being undefined (timing issue OR HTML bug).
âœ… You do not currently have defensive logic to know whether youâ€™re displaying LIVE or HISTORICAL data â†’ causing JS bugs.
âœ… The flow of your initializeDashboard() is wrong â†’ load live first, fallback second ONLY IF NEEDED.

5ï¸âƒ£ How to fix it â†’ here is your correct flow:
js
Copy
Edit
async function initializeDashboard() {
    console.log('=== INITIALIZING DASHBOARD ===');
    
    // Load live alerts FIRST
    try {
        console.log('Trying to load live radar alerts first...');
        await loadLiveAlerts();

        // Check if any live alerts were loaded
        if (!window.currentAlerts || window.currentAlerts.length === 0) {
            console.log('No live alerts found, loading fallback radar alerts...');
            await loadFallbackRadarAlerts();
        } else {
            console.log(`Live alerts loaded: ${window.currentAlerts.length}`);
        }
    } catch (error) {
        console.error('Error loading live radar alerts:', error);
        console.log('Falling back to historical radar alerts...');
        await loadFallbackRadarAlerts();
    }

    // Set up auto-refresh
    autoRefreshInterval = setInterval(loadLiveAlerts, 30000);
    console.log('Dashboard initialized successfully');
}
ğŸ‘‰ This guarantees:

âœ… You FIRST show LIVE alerts if possible
âœ… You ONLY fallback to historical if live fails or returns zero
âœ… You eliminate the bad priority bug you currently have.

6ï¸âƒ£ Regarding tbody bug:
ğŸ‘‰ I suspect one of these:

You may have TWO elements with id="liveRadarTableBody" (check full page HTML after template rendering â€” very common bug when copying templates)

Your HTML may not have finished rendering yet when displayAlerts() is called â†’ this happens if your DOMContentLoaded listener is firing too early.

ğŸ‘‰ To force safe execution, wrap initializeDashboard() in:

js
Copy
Edit
document.addEventListener('DOMContentLoaded', () => {
    setTimeout(() => {
        initializeDashboard();
    }, 200);  // Small delay to ensure DOM is ready
});
ğŸ‘‰ This is a TEMP FIX â€” but it will prove if DOM timing is the issue.

7ï¸âƒ£ Conclusion:
ğŸ‘‰ Your core diagnosis is 100% correct: the page is stuck because:

âœ… You are showing the wrong data FIRST (historical)
âœ… JS is failing in displayAlerts() because itâ€™s treating mixed live/historical data the same
âœ… Your fallback flow is inverted â†’ should fallback ONLY if live fails
âœ… tbody undefined â†’ likely timing issue or HTML bug â†’ must check template.